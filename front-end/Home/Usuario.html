<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="Jquery"></script>
    <style>
      .example::-webkit-scrollbar {
    display: none;
  }
  
  /* Hide scrollbar for IE, Edge and Firefox */
  .example {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />


    <link rel="stylesheet" href="BootstrapCSS">
    <link rel="stylesheet" href="MCSS">
    <link rel="stylesheet" href="FCSS">
    <link rel="stylesheet" href="CCSS2">
    <link rel="stylesheet" href="BotCSS">

    <script src="BotJS"></script>
    <script src="BootstrapJS"></script>
    <script src="publicaciones.js"></script>
    <script src="persona.js"></script>
    
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <title>Perfil</title>
</head>

<body onload="cargarTabla()" class="example">
  <div id="loadingOverlay">
    <div class="text-center">
      <div class="spinner-border text-danger" role="status" style="width: 5rem;
    height: 5rem; margin-top: 200%">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
  </div>
  
  <div id="contenido" class="hidden">
  <nav class="main-menu">
    <span id="logo"> <img src="/Logo2" width="58px"
      height="60px" alt=""> 
 </span>

 <div class="scrollbar" id="style-1">
       
 <ul>
   
  
  <div>
    <a class="logo" href="/Logo">
    </a> 
  </div> 
<div class="settings"></div>
<div class="scrollbar" id="style-1">
      

<li>                                   
<a href="/index">
<i class="fa fa-home fa-lg"></i>
<span class="nav-text">Home</span>
</a>
</li>   
     
<li>                                 
  <a href="/Usuario">
    <i class="fa fa-user fa-lg"></i>
    <span class="nav-text">Perfil</span>
    </a>
    </li>    
 
     
 <ul class="logout">
  <li>
                     <a href="/Blog">
                           <i class="fa fa-lightbulb-o fa-lg"></i>
                          <span class="nav-text">
                              BLOG 
                          </span>
                          
                      </a>
  </li>  
  </ul>
 
  
  <li>                                 
    <a href="chat">
    <i class="fa fa-envelope-o fa-lg"></i>
    <span class="nav-text">Chats</span>
    </a>
    </li>   
      
    <li >
      <a href="MainPublicaciones">
      <i class="fa fa-search"></i>
      <span class="nav-text">Explorar</span>
      </a>
      </li>
     
        
   
</li>
<li class="darkerlishadow">
<a href="noticias">
<i class="fa fa-clock-o fa-lg"></i>
<span class="nav-text">Noticias</span>
</a>
</li>
 
         
<li class="darkerli">
 <a href="guia">
 <i class="fa fa-search"></i>
 <span class="nav-text">Guia pagina</span>
 </a>
 </li>

<li class="darkerli">
<a href="Historia">
<i class="fa fa-desktop fa-lg"></i>
<span class="nav-text">historia del proyecto</span>
</a>
</li>
  

<li class="darkerli">
<a href="intercambios">
<i class="fa fa-refresh"></i>
 <span class="nav-text">Acerca de los intercabios</span>
</a>
</li>
<li class="darkerli">
  <a href="help  ">
  <i class="fa fa-question-circle fa-lg"></i>
   <span class="nav-text">Help</span>
  </a>
  </li>  


  
         </nav>
<section>
    <div class="container py-5">
  
      <div class="row">
        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-body text-center">
              <img src="/Perfil" alt="Imagen de perfil" id="perfilImagen"
                class="rounded-circle img-fluid" style="height: 150px; width: 150px;">
              <h5 class="my-3" id="nombreUsuario"></h5>
              <button type="button" class="btn btn-primary" onclick="showForm()"><i class="fa-sharp fa-solid fa-image"></i></button>
              <button type="button" class="btn btn-outline-primary ms-1" id="logoutButton">Cerrar sesión</button>
            </div>
          </div>
        </div>
        <div class="col-lg-8">
          <div class="card mb-4">
            <div class="card-body">
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Nombre completo</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0" id="nombreUsuario2"> </p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Email</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0" id="emailUsuario"> </p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0"></p>Genero</p>
                </div>
                <div class="col-sm-3">
                  <p class="text-muted mb-0" id="generoUsuario"></p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Fecha de nacimiento</p>
                </div>
                <div class="col-sm-3">
                  <p class="text-muted mb-0" id="fechaUsuario"> </p>
                </div>
              </div>
              <hr>
              <div class="row">
                <div class="col-sm-3">
                  <p class="mb-0">Numero de telefono</p>
                </div>
                <div class="col-sm-9">
                  <p class="text-muted mb-0">8965-2134</p>
                </div>
              </div>
            </div>
          </div>
    </div>
  </section>
  <h1 class="titulo">Tus publicaciones</h1>
  <div class="fondoCard">	
    <div class="card1-container" id="cuaerpodelatabladeoperaciones">     
    </div>
</div>
<div id="toggle-chat-btn" class="chat-toggle-button">
  <img src="/SkillBotLogo" alt="Open Chat">
</div>


<div class="content chat-container">  
  <div class="close-chat-btn">X</div>
<div class="content">
<div id="chat-contents">
</div>
<div class="chat-box">
  <input type="text" id="chat-message-value" autocomplete="off" placeholder="Type a message">
  <button id="submit-chat">
    <svg width="15" height="20" viewBox="0 0 30 21">
      <path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z"></path>
    </svg>
  </button>
</div>
</div>
</div>











<div class="overlay" id="overlay">
  <div class="formF">
    <form>
      <span class="close" onclick="hideForm()">x</span>
      <h1 class="title2">Actualiza tu imagen de perfil</h1>

    <div class="row">
    <div class="small-12 medium-2 large-2 columns">
    <div class="circle">
    <img class="profile-pic" src="https://t3.ftcdn.net/jpg/03/46/83/96/360_F_346839683_6nAPzbhpSkIpb8pmAwufkC7c5eD7wYws.jpg">

    </div>
    <div class="p-image">
    <i class="fa fa-camera upload-button"></i>
    <input class="file-upload" id="inputFotoPerfil" type="file" accept="image/*"/>
    </div>
    </div>
    <button class="boton"  type="button" id="btnActualizarImagen">Actualizar imagen</button>
    </div>
   
   
    </div>  
    </div>
</div>

















</body>
<footer class="footer-basic">
              <div class="social">
                  <a href="#"><i class="icon ion-social-instagram"></i></a>
                  <a href="#"><i class="icon ion-social-facebook"></i></a>      
                  <a href="#"><i class="icon ion-ios-telephone"></i></a>
                  <a href="#"><i class="icon ion-ios-email"></i></a>
              </div>
              <ul class="list-inline">
                  <li class="list-inline-item"><a href="/Servicios">Servicios</a></li>
                  <li class="list-inline-item"><a href="/Acerca_de">Acerca de</a></li>
                  <li class="list-inline-item"><a href="/Terminos">Terminos</a></li>
                  <li class="list-inline-item"><a href="/Politicas">Politica de Privacidad</a></li>
              </ul>
              <p class="copyright">BrigdeSkill © 2023</p>
              <link rel="stylesheet" href="footer.css">
          </footer></div>
          <script type:"text-javascript">

document.addEventListener("DOMContentLoaded", function () {
  // Agregar la clase 'loading' al body para ocultar la barra de desplazamiento
  document.body.classList.add("loading");

  // Simulación de carga con retardo de 3 segundos
  setTimeout(function () {
    var overlay = document.getElementById("loadingOverlay");
    var contenido = document.getElementById("contenido");
    
    overlay.style.display = "none";
    contenido.classList.remove("hidden");
    
    // Eliminar la clase 'loading' para mostrar la barra de desplazamiento nuevamente
    document.body.classList.remove("loading");
  }, 1000);
});



let imagenbase64 = "";

$("#inputFotoPerfil").change(function() {
    readURL(this);
});

$("#btnActualizarImagen").click(function() {
    if (imagenbase64) {
      const tics_instanciada = new personaP();
      tics_instanciada.enviarImagen(imagenbase64).then((message) => {
          console.log("Éxito:", message);
          
          // Recarga la página después de un cambio exitoso
          location.reload();

      }).catch((error) => {
          console.error("Error:", error);
      });
    } else {
        console.error("No se ha seleccionado ninguna imagen.");
    }
});



function readURL(input){
    if (input.files && input.files[0]){
        let reader = new FileReader();

        reader.onload = function(e){
            imagenbase64 = e.target.result;
            console.log(imagenbase64)
        }
        reader.readAsDataURL(input.files[0]);
    }
}


    let nombreUsuario = "";

    function obtenerDatosUsuario() {
    const tics_instanciada = new personaP();
    tics_instanciada.obtenerUsuario().then(function(response) {
      nombreUsuario = response.NOMBRE;
      apellidoUsuario = response.APELLIDO;
      emailUsuario = response.EMAIL;
      fechaUsuario = response.FECHAN;
      generoUsuario = response.GENERO;

      // Actualizar el elemento HTML con el nombre del usuario
        const nombreElemento2 = document.getElementById('nombreUsuario2');
        nombreElemento2.textContent = nombreUsuario +" "+ apellidoUsuario;

        const nombreElemento = document.getElementById('nombreUsuario');
        nombreElemento.textContent = nombreUsuario;

        const nacimientoElemento = document.getElementById('fechaUsuario');
        nacimientoElemento.textContent = fechaUsuario;

        const generoElemento = document.getElementById('generoUsuario');
        generoElemento.textContent = generoUsuario;

        const emailElemento = document.getElementById('emailUsuario');
        emailElemento.textContent = emailUsuario;

      // Obtener el elemento de la imagen de perfil
      const perfilImagen = document.getElementById('perfilImagen');
      // Actualizar la URL de la imagen de perfil
      perfilImagen.src = response.FOTO;
    }).catch(function(error) {
      console.error('Error al obtener los datos del usuario:', error);
    });
  }
    
  function Guardar() {
  var FECHAACTUAL = new Date(); // Obtener la fecha y hora actual

  var tics_instanciada = new publicacionesdb(
    0,
    nombreUsuario,
    document.getElementById("INTERES").value,
    document.getElementById("SABE").value,
    document.getElementById("NUMERO").value,
    imagenbase64,
    FECHAACTUAL // Agregar la fecha actual a la publicación
  );

  tics_instanciada.Guardar()
    .then(function (response) {
      console.log("Success!", response);
      alert("Guardado con éxito");
      cargarTabla();
    })
    .catch(function (error) {
      console.error("Failed", error);
      alert("Error " + error);
    });
  }

  function Eliminar(id) {
  const tics_instanciada = new publicacionesdb();
  tics_instanciada._id = id;
  tics_instanciada.Eliminar()
    .then(function (response) {
      console.log("Success!", response);
      swal({
                      icon: 'success',
                      text: 'Eliminado con éxito'
                    });
    
      cargarTabla();
    })
    .catch(function (error) {
      console.error("Failed", error);
      swal({
                      icon: 'error',
                      text: 'Error al eliminar'
                    });
      

    });
}



  function cargarTabla() {
  obtenerDatosUsuario();

  var tics_instanciada = new publicacionesdb(); 
  tics_instanciada.ListarPorID()
    .then(function (response) {
      // Ordenar las publicaciones en orden inverso según la fecha de guardado
      response.sort(function (a, b) {
        return new Date(b.FECHAACTUAL) - new Date(a.FECHAACTUAL);
      });

      var cardContent = ""; // Variable para almacenar el contenido del card

      // Iterar sobre las últimas publicaciones
      for (var elemento of response) {
  cardContent +=
    '<article class="card1">' +
    '<img class="card1__background" src="' +
    elemento.FOTO +
    '" alt="" width="1920" height="2193"/>' +
    '<div class="card1__content | flow">' +
    '<div class="card1__content--container | flow">' +
    '<h2 class="card1__title">' +
    elemento.NOMBRE +
    '</h2>' +
    '<p class="card1__description">' +
    "Interes: " +
    elemento.INTERES +
    "<br>" +
    "Sabe: " +
    elemento.SABE +
    '</p>' +
    '</div>' +
    '<div class="button-container">' +
    '<button class="card1__button">' +
    "+506 " +
    elemento.NUMERO +
    '</button>' +
    '<button class="card1__button" onclick="Eliminar(\'' + elemento._id + '\')"><i class="fa-solid fa-trash"\></i></button>' +
    '</div>' +
    '</div>' +
    '</article>';
}

      // Agregar el contenido del card al elemento contenedor
      document.getElementById(
        "cuaerpodelatabladeoperaciones"
      ).innerHTML = cardContent;
    })
    .catch(function (error) {
      console.error("Failed", error);
      alert("Error " + error);
    });
}

const logoutButton = document.getElementById('logoutButton');

logoutButton.addEventListener('click', function() {

  const tics_instanciada = new personaP();
  tics_instanciada.Logout()
  window.location.href = '/Login';
});


























function showForm() {
    const overlay = document.getElementById('overlay');
    overlay.style.display = 'flex';
    setTimeout(() => {
        overlay.style.opacity = '1';
    }, 50);

    // Desactiva el desplazamiento en la página principal
    document.body.style.overflow = 'hidden';
}

        function hideForm() {
            const overlay = document.getElementById('overlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 500);


            document.querySelector('.overlay').style.display = 'none';
  
  // Reactiva el desplazamiento en la página principal
  document.body.style.overflow = 'auto';
        }



$(document).ready(function() {

    
    var readURL = function(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('.profile-pic').attr('src', e.target.result);
            }
    
            reader.readAsDataURL(input.files[0]);
        }
    }
    

    $(".file-upload").on('change', function(){
        readURL(this);
    });
    
    $(".upload-button").on('click', function() {
       $(".file-upload").click();
    });
});


          </script>

</html>







<style>

.overlay {
  display: none; 
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(87, 40, 126, 0.5);

    align-items: center;
    justify-content: center;
    z-index: 9998;
}

.formF {
    z-index: 9999;
    box-shadow: 0 5px 10px 2PX rgba(71, 3, 6, 0.7);
    background: #fff;
    text-align: center;
    padding: 20px 25px;
    border-radius: 10px;
    position: relative;
    width: 80%;
    max-width: 400px;
}

.formF .close {
    position: absolute;
    right: 10px;
    top: 10px;
    cursor: pointer;
    font-size: 1.5em;
}

.circle {
  position: relative;
    border-radius: 100% !important;
    overflow: hidden;
    width: 128px;
    height: 128px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    margin: 20px auto;
}

.profile-pic {
    width: 100%;
    height: auto;
}

.p-image {
    margin-left: 200px;
    text-align: center;
    margin-top: -35px;
    color: #666;
    transition: all .3s cubic-bezier(.175, .885, .32, 1.275);

}

.upload-button {
    font-size: 1.4em;
    cursor: pointer;
    z-index: 2;
}

.upload-button:hover {
    color: #999;
}

.boton {
    background-color: #57287E;
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.boton:hover {
    background-color: #4A2165;
}

.file-upload {
    position: absolute;
    bottom: 8px;  /* Posición de inicio del ícono desde abajo */
    right: 8px;   /* Posición de inicio del ícono desde la derecha */
    opacity: 0;
    cursor: pointer;
    height: 40px; /* Puedes ajustar estos valores según el tamaño real del ícono de la cámara */
    width: 40px;  /* Puedes ajustar estos valores según el tamaño real del ícono de la cámara */
    z-index: 2;   /* Asegura que el input esté encima del ícono */
}


</style>